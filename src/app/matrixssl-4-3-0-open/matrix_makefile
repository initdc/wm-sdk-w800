RM := rm -rf

# All of the sources participating in the build are defined here
O_SRCS := 
C_SRCS := 
S_SRCS := 
S_UPPER_SRCS := 
OBJ_SRCS := 
ASM_SRCS := 
BIN_SRCS := 
OBJS := 
C_DEPS := 
ASM_DEPS := 
S_DEPS := 
S_UPPER_DEPS := 

# Every subdirectory with source files must be described here
SUBDIRS := \
matrixssl \
crypto/symmetric \
crypto/scalarmult \
crypto/scalarmult/ed25519/ref10 \
crypto/scalarmult/curve25519 \
crypto/scalarmult/curve25519/sandy2x \
crypto/scalarmult/curve25519/ref10 \
crypto/scalarmult/crypto_core/ed25519/ref10 \
crypto/scalarmult/crypto_core/ed25519 \
crypto/pubkey \
crypto/prng \
crypto/math \
crypto/layer \
crypto/keyformat \
crypto/digest \
crypto/crypto_sign \
crypto/crypto_sign/ed25519 \
crypto/crypto_sign/ed25519/ref10 \
crypto/common \
crypto/aead/chacha20poly1305ietf \
crypto/aead/chacha20poly1305ietf/sse2 \
crypto/aead/chacha20poly1305ietf/ref \
crypto/aead/chacha20poly1305ietf/donna \
crypto/aead/chacha20poly1305ietf/dolbeau \
core/wrapper \
core/src \
core/osdep/src \
core/osdep \
core/osdep/ANSI \

C_SRCS += \
core/osdep/osdep.c \
core/osdep/ANSI/osdep_break.c \
core/osdep/ANSI/spal_memory_ansi.c \
core/osdep/src/cl_memset.c \
core/osdep/src/runtime.c \
core/src/bmp.c \
core/src/cl_basic.c \
core/src/corelib_date.c \
core/src/corelib_list.c \
core/src/corelib_main.c \
core/src/corelib_strings.c \
core/src/corelib_trace.c \
core/src/c_lib.c \
core/src/debug_abort.c \
core/src/debug_printf.c \
core/src/memset_s.c \
core/src/psbuf.c \
core/src/psmalloc.c \
core/src/psmalloc_ext.c \
core/src/psprintf.c \
core/src/psStat.c \
core/src/psUtil.c \
core/src/sfzclbase64.c \
core/src/sfzclbuffer.c \
core/src/sfzclcalendar.c \
core/src/sfzclfastalloc.c \
core/src/sfzclfileio.c \
core/src/sfzclmalloc.c \
core/src/sfzclmemparser.c \
core/src/sfzclobstack.c \
core/src/sfzclsnprintf.c \
core/src/sfzclstr.c \
core/src/sfzcltime.c \
core/src/sfzcltimemeasure.c \
core/src/sl_cpu.c \
core/src/sl_neon.c \
core/src/utils.c \
core/wrapper/wrap-malloc.c \
crypto/aead/chacha20poly1305ietf/aead_chacha20poly1305.c \
crypto/aead/chacha20poly1305ietf/onetimeauth_poly1305.c \
crypto/aead/chacha20poly1305ietf/ps_chacha20poly1305ietf.c \
crypto/aead/chacha20poly1305ietf/runtime.c \
crypto/aead/chacha20poly1305ietf/stream_chacha20.c \
crypto/aead/chacha20poly1305ietf/utils.c \
crypto/aead/chacha20poly1305ietf/verify.c \
crypto/aead/chacha20poly1305ietf/dolbeau/chacha20_dolbeau-avx2.c \
crypto/aead/chacha20poly1305ietf/dolbeau/chacha20_dolbeau-ssse3.c \
crypto/aead/chacha20poly1305ietf/donna/poly1305_donna.c \
crypto/aead/chacha20poly1305ietf/ref/chacha20_ref.c \
crypto/aead/chacha20poly1305ietf/sse2/poly1305_sse2.c \
crypto/common/alg_info.c \
crypto/common/digest_info.c \
crypto/crypto_sign/crypto_sign.c \
crypto/crypto_sign/ps_ed25519.c \
crypto/crypto_sign/ed25519/sign_ed25519.c \
crypto/crypto_sign/ed25519/ref10/open.c \
crypto/crypto_sign/ed25519/ref10/sign.c \
crypto/digest/digest_libsodium.c \
crypto/digest/digest_openssl.c \
crypto/digest/hash.c \
crypto/digest/hkdf.c \
crypto/digest/hmac.c \
crypto/digest/md2.c \
crypto/digest/md4.c \
crypto/digest/md5.c \
crypto/digest/md5sha1.c \
crypto/digest/sha1.c \
crypto/digest/sha256.c \
crypto/digest/sha256_standalone.c \
crypto/digest/sha512.c \
crypto/keyformat/asn1.c \
crypto/keyformat/asn1fmt.c \
crypto/keyformat/base64.c \
crypto/keyformat/crl.c \
crypto/keyformat/pem_decode_file.c \
crypto/keyformat/pem_decode_mem.c \
crypto/keyformat/pkcs.c \
crypto/keyformat/x509.c \
crypto/layer/matrix.c \
crypto/math/pstm.c \
crypto/math/pstmnt.c \
crypto/math/pstm_montgomery_reduce.c \
crypto/math/pstm_mul_comba.c \
crypto/math/pstm_sqr_comba.c \
crypto/math/pstm_str.c \
crypto/prng/prng.c \
crypto/prng/yarrow.c \
crypto/pubkey/dh.c \
crypto/pubkey/dh_export.c \
crypto/pubkey/dh_gen_key.c \
crypto/pubkey/dh_gen_secret.c \
crypto/pubkey/dh_import.c \
crypto/pubkey/dh_import_priv.c \
crypto/pubkey/dh_params.c \
crypto/pubkey/ecc.c \
crypto/pubkey/ecc_curve.c \
crypto/pubkey/ecc_curve_config.c \
crypto/pubkey/ecc_curve_data.c \
crypto/pubkey/ecc_export.c \
crypto/pubkey/ecc_gen_shared.c \
crypto/pubkey/ecc_import.c \
crypto/pubkey/ecc_keygen.c \
crypto/pubkey/ecc_math.c \
crypto/pubkey/ecc_parse_file.c \
crypto/pubkey/ecc_parse_mem.c \
crypto/pubkey/ecc_priv.c \
crypto/pubkey/ecc_priv_el_gamal.c \
crypto/pubkey/ecc_pub.c \
crypto/pubkey/ecc_write_file.c \
crypto/pubkey/ecc_write_mem.c \
crypto/pubkey/pubkey.c \
crypto/pubkey/pubkey_parse_file.c \
crypto/pubkey/pubkey_parse_mem.c \
crypto/pubkey/pubkey_sign.c \
crypto/pubkey/pubkey_verify.c \
crypto/pubkey/mrsa.c \
crypto/pubkey/mrsa_keygen.c \
crypto/pubkey/mrsa_openssl.c \
crypto/pubkey/mrsa_parse_file.c \
crypto/pubkey/mrsa_parse_mem.c \
crypto/pubkey/mrsa_priv.c \
crypto/pubkey/mrsa_pub.c \
crypto/pubkey/mrsa_write_file.c \
crypto/pubkey/mrsa_write_mem.c \
crypto/scalarmult/crypto_scalarmult.c \
crypto/scalarmult/ps_x25519.c \
crypto/scalarmult/crypto_core/ed25519/core_ed25519.c \
crypto/scalarmult/crypto_core/ed25519/ref10/ed25519_ref10.c \
crypto/scalarmult/curve25519/scalarmult_curve25519.c \
crypto/scalarmult/curve25519/ref10/x25519_ref10.c \
crypto/scalarmult/curve25519/sandy2x/curve25519_sandy2x.c \
crypto/scalarmult/curve25519/sandy2x/fe51_invert.c \
crypto/scalarmult/curve25519/sandy2x/fe_frombytes_sandy2x.c \
crypto/scalarmult/ed25519/ref10/scalarmult_ed25519_ref10.c \
crypto/symmetric/aes.c \
crypto/symmetric/aesCBC.c \
crypto/symmetric/aesGCM.c \
crypto/symmetric/aes_aesni.c \
crypto/symmetric/arc4.c \
crypto/symmetric/des3.c \
crypto/symmetric/idea.c \
crypto/symmetric/rc2.c \
crypto/symmetric/seed.c \
crypto/symmetric/symmetric_libsodium.c \
crypto/symmetric/symmetric_openssl.c \
matrixssl/cipherSuite.c \
matrixssl/dtls.c \
matrixssl/extDecode.c \
matrixssl/hsDecode.c \
matrixssl/hsHash.c \
matrixssl/hsHashBuffered.c \
matrixssl/hsNegotiateVersion.c \
matrixssl/matrixssl.c \
matrixssl/matrixsslApi.c \
matrixssl/matrixsslGetSet.c \
matrixssl/matrixsslInitVer.c \
matrixssl/matrixsslKeys.c \
matrixssl/matrixsslNet.c \
matrixssl/matrixsslSecConfig.c \
matrixssl/matrixsslSocket.c \
matrixssl/prf.c \
matrixssl/psk.c \
matrixssl/sslDecode.c \
matrixssl/sslEncode.c \
matrixssl/sslv3.c \
matrixssl/tls.c \
matrixssl/tls13Adapter.c \
matrixssl/tls13Authenticate.c \
matrixssl/tls13CipherSuite.c \
matrixssl/tls13Decode.c \
matrixssl/tls13DecodeExt.c \
matrixssl/tls13Encode.c \
matrixssl/tls13EncodeExt.c \
matrixssl/tls13KeyAgree.c \
matrixssl/tls13KeySchedule.c \
matrixssl/tls13Negotiate.c \
matrixssl/tls13Psk.c \
matrixssl/tls13Resume.c \
matrixssl/tls13SigVer.c \
matrixssl/tls13TrHash.c \
matrixssl/tls13TrHashBuffered.c \
matrixssl/tlsDefaults.c \
matrixssl/tlsSelectKeys.c \
matrixssl/tlsSigVer.c \
matrixssl/tlsTrace.c \

OBJS1 := $(patsubst %.c,%.o,$(C_SRCS))

C_DEPS1 := $(patsubst %.c,%.d,$(C_SRCS))

OBJS += \
$(foreach n, $(OBJS1), ./$(n))

C_DEPS += \
$(foreach n, $(C_DEPS1), ./$(n))

INCLUDES := \
-I../../../include \
-I../../../include/os \
-I../../../include/net \
-I../../../include/arch/xt804 \
-I../../../include/arch/xt804/csi_core \
-I../../../include/arch/xt804/csi_dsp \
-I../../../include/app \
-I../../../include/platform \
-I../../../platform/common/params \
-I../../../platform/inc \
-I../../../src/app/matrixssl-4-3-0-open/core/include \
-I../../../src/app/matrixssl-4-3-0-open/core/include/sfzcl \
-I../../../src/app/matrixssl-4-3-0-open/core/config \
-I../../../src/app/matrixssl-4-3-0-open/core/osdep/include \
-I../../../src/app/matrixssl-4-3-0-open/crypto \
-I../../../src/app/matrixssl-4-3-0-open/crypto/crypto_sign/include/sodium \
-I../../../src/app/matrixssl-4-3-0-open/crypto/scalarmult/include/sodium \
-I../../../src/app/matrixssl-4-3-0-open/crypto/aead/chacha20poly1305ietf \
-I../../../src/app/matrixssl-4-3-0-open \

ifneq ($(MAKECMDGOALS),clean)
ifneq ($(strip $(C_DEPS)),)
-include $(C_DEPS)
endif
endif

define C_COMPILE_DESC
$(1): $(1:%.o=%.c)
	@echo 'Building file: $(1:%.o=%.c)'
	@echo 'Invoking: CSky Elf C Compiler'
	csky-elfabiv2-gcc -mcpu=ck804ef -DGCC_COMPILE=1 -DTLS_CONFIG_CPU_XT804=1 $(INCLUDES) -O2 -fdata-sections -mhard-float -g3 -Wall -c -ffunction-sections -o "./$(1)" "$(1:%.o=%.c)" && \
	echo -n '$(1:%.o=%.d)' $(dir $(1)) > '$(1:%.o=%.d)' && \
	csky-elfabiv2-gcc -MM -MG -P -w -mcpu=ck804ef -DGCC_COMPILE=1 -DTLS_CONFIG_CPU_XT804=1 $(INCLUDES) -O2 -fdata-sections -mhard-float -g3 -Wall -c -ffunction-sections   "$(1:%.o=%.c)" >> '$(1:%.o=%.d)'
	@echo 'Finished building: $(1:%.o=%.c)'
	@echo ' '	
endef

# Each subdirectory must supply rules for building sources it contributes
$(foreach n, ${OBJS1}, $(eval $(call C_COMPILE_DESC,$(n))))

test:
	@echo $(INCLUDES:-I%=%)
	
# All Target
all: main-build

# Main-build Target
main-build: libMatrix.a

# Output Target
libMatrix.a: $(OBJS)
	@echo 'Outputing file $@'
	csky-elfabiv2-ar -rcs $@ $(OBJS)
	@echo 'Finished outputing: $@'
	csky-elfabiv2-strip -g -o ./libMatrixssl.a ./$@
	@echo ' '

# Other Targets
clean:
	-$(RM) libMatrix.a
	-$(RM) $(OBJS)$(C_DEPS)
	-@echo ' '

.PHONY: all clean dependents
.SECONDARY: main-build

